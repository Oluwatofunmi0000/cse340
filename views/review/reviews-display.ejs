<div class="reviews-section" style="margin-top: 2rem; padding-top: 2rem; border-top: 2px solid #ddd;">
  <h2>Customer Reviews</h2>

  <% if (typeof stats !== 'undefined' && stats && stats.review_count > 0) { %>
    <div class="review-stats" style="background: #f5f5f5; padding: 1rem; margin-bottom: 1.5rem; border-radius: 4px;">
      <p style="margin: 0;">
        <strong style="font-size: 1.2em;"><%= stats.average_rating %></strong> 
        <span style="color: #ff9800;">
          <% for (let i = 0; i < Math.round(stats.average_rating); i++) { %>★<% } %><% for (let i = Math.round(stats.average_rating); i < 5; i++) { %>☆<% } %>
        </span>
        <span style="color: #666; margin-left: 1rem;">(<%= stats.review_count %> <%= stats.review_count === 1 ? 'review' : 'reviews' %>)</span>
      </p>
    </div>
  <% } %>

  <% if (locals.loggedin) { %>
    <a href="/review/add/<%= inv_id %>" class="btn-add-review" style="display: inline-block; background: #005b96; color: white; padding: 0.5rem 1rem; border-radius: 4px; text-decoration: none; margin-bottom: 1.5rem; font-weight: 600;">
      Add Your Review
    </a>
  <% } else { %>
    <p style="background: #e3f2fd; padding: 1rem; border-left: 4px solid #005b96; margin-bottom: 1.5rem;">
      <a href="/account/login">Login</a> to add a review for this vehicle.
    </p>
  <% } %>

  <% if (typeof reviews !== 'undefined' && reviews.length > 0) { %>
    <div class="reviews-list">
      <% reviews.forEach(review => { %>
        <div class="review-item" style="background: white; border: 1px solid #ddd; padding: 1rem; margin-bottom: 1rem; border-radius: 4px;">
          <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 0.5rem;">
            <div>
              <strong><%= review.account_firstname %> <%= review.account_lastname %></strong>
              <span style="color: #ff9800; margin-left: 0.5rem; font-size: 1.1em;">
                <% for (let i = 0; i < review.review_rating; i++) { %>★<% } %><% for (let i = review.review_rating; i < 5; i++) { %>☆<% } %>
              </span>
            </div>
            <% if (locals.loggedin && (locals.accountData.account_id === review.account_id || locals.accountData.account_type === 'Admin')) { %>
              <a href="/review/delete/<%= review.review_id %>" 
                 onclick="return confirm('Are you sure you want to delete this review?');"
                 style="color: #c33; text-decoration: underline; font-size: 0.9em;">
                Delete
              </a>
            <% } %>
          </div>
          <p style="color: #999; font-size: 0.9em; margin: 0.5rem 0;">
            <%= new Date(review.review_created_at).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' }) %>
          </p>
          <p style="margin: 0.5rem 0; line-height: 1.5;"><%= review.review_text %></p>
        </div>
      <% }) %>
    </div>
  <% } else { %>
    <p style="color: #666; font-style: italic;">No reviews yet. Be the first to review this vehicle!</p>
  <% } %>
</div>
